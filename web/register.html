<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>注册</title>

        <!-- CSS -->
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:400,100,300,500">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" href="assets/css/form-elements.css">
        <link rel="stylesheet" href="assets/css/style.css">
        <link rel="stylesheet" href="assets/css/cropper.min.css">
        <link rel="stylesheet" href="assets/css/ImgCropping.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- Favicon and touch icons -->
        <link rel="shortcut icon" href="assets/ico/favicon.png">
        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">
        <script src="assets/js/jquery-1.11.1.min.js"></script>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/js/jquery.backstretch.min.js"></script>
        <script src="assets/js/scripts.js"></script>
        <script src="assets/js/Connector.js"></script>
        <!--        <script src="lib/js/register.js"></script>-->
        <script src="assets/js/cropper.min.js"></script>
        <script src="assets/js/register.js" type="text/javascript"></script>
        <script>
            function onRegister() {
                alert("dd");
                sex = $('input:radio[name="radio"]:checked').val();
                alert(sex);
                var usersex = sex === 1 ? true : false;
//                if(sex === 1){
//                    usersex = true;
//                }else{
//                    usersex = false;
//                }
                var username = $('#form-username').val();
                var password = $('#form-password').val();
                console.log(username);
                console.log(password);
                Connector({
                    url: "TotalServer",
                    params: {
                        type: "USER_REGISTER",
                        data: {
                            username: username,
                            password: password,
                            phone: $('#form-Phone').val(),
                            email: $('#form-Email').val(),
                            sex: usersex,
                            address: $('#form-UserAddress').val(),
                            intro: $('#form-UserIntro').val()
                        }
                    },
                    success: function (json) {
                        alert("chenggong");
                    },
                    failure: function () {
                        alert("fail");
                    }
                });
            }
        </script>

        <script>
            //弹出图片裁剪框
            $("#replaceImg").on("click", function () {
                $(".tailoring-container").toggle();
            });
            //图像上传
            function selectImg(file) {
                if (!file.files || !file.files[0]) {
                    return;
                }
                var reader = new FileReader();
                reader.onload = function (evt) {
                    var replaceSrc = evt.target.result;
                    //更换cropper的图片
                    $('#tailoringImg').cropper('replace', replaceSrc, false);//默认false，适应高度，不失真
                }
                reader.readAsDataURL(file.files[0]);
            }
            //cropper图片裁剪
            $('#tailoringImg').cropper({
                aspectRatio: 1 / 1, //默认比例
                preview: '.previewImg', //预览视图
                guides: false, //裁剪框的虚线(九宫格)
                autoCropArea: 0.5, //0-1之间的数值，定义自动剪裁区域的大小，默认0.8
                movable: false, //是否允许移动图片
                dragCrop: true, //是否允许移除当前的剪裁框，并通过拖动来新建一个剪裁框区域
                movable: true, //是否允许移动剪裁框
                resizable: true, //是否允许改变裁剪框的大小
                zoomable: false, //是否允许缩放图片大小
                mouseWheelZoom: false, //是否允许通过鼠标滚轮来缩放图片
                touchDragZoom: true, //是否允许通过触摸移动来缩放图片
                rotatable: true, //是否允许旋转图片
                crop: function (e) {
                    // 输出结果数据裁剪图像。
                }
            });
            //旋转
            $(".cropper-rotate-btn").on("click", function () {
                $('#tailoringImg').cropper("rotate", 45);
            });
            //复位
            $(".cropper-reset-btn").on("click", function () {
                $('#tailoringImg').cropper("reset");
            });
            //换向
            var flagX = true;
            $(".cropper-scaleX-btn").on("click", function () {
                if (flagX) {
                    $('#tailoringImg').cropper("scaleX", -1);
                    flagX = false;
                } else {
                    $('#tailoringImg').cropper("scaleX", 1);
                    flagX = true;
                }
                flagX != flagX;
            });

            //裁剪后的处理
            $("#sureCut").on("click", function () {
                if ($("#tailoringImg").attr("src") == null) {
                    return false;
                } else {
                    var cas = $('#tailoringImg').cropper('getCroppedCanvas');//获取被裁剪后的canvas
                    var base64url = cas.toDataURL('image/png'); //转换为base64地址形式
                    $("#finalImg").prop("src", base64url);//显示为图片的形式

                    //关闭裁剪框
                    closeTailor();
                }
            });
            //关闭裁剪框
            function closeTailor() {
                $(".tailoring-container").toggle();
            }

            var imgurl = '';
            var usersex = '';
            //上传图片
            function upload() {
                var filetype = ['jpg', 'jpeg', 'png', 'gif'];
                var fi = document.getElementById('chooseImg').files[0];
                var fname = fi.name.split('.');
                if (filetype.indexOf(fname[1].toLowerCase()) === -1) {
                    alert('文件格式不支持');
                    return;
                }
                var fr = new FileReader();
                fr.readAsDataURL(fi);//以base64编码格式读取图片文件
                fr.onload = function (frev) {
                    var pic = frev.target.result;
                    connector({
                        params: {
                            type: "SYSTEM_SCTP",
                            username: $('#form-username').val(),
                            message = pic,
                            filename: fname[0],
                            filetype: fname[1],
                            filesize: fi.size
                        },
                        success: function (json) {
                            imgurl = json.imgurl;
                        },
                        error: function (json) {
                            imgurl = json.imgurl;
                        }
                    })
                }
            }
        </script>
        
    </head>

    <body>

        <!-- Top content -->
        <div class="top-content">
            <div class="inner-bg">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-8 col-sm-offset-2 text">
                            <h1><strong>HappyShare</strong> Register Form</h1>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6 col-sm-offset-3 form-box">
                            <div class="form-top">
                                <div class="form-top-left">
                                    <h3>Login to our site</h3>
                                </div>
                                <div class="form-top-right">
                                    <i class="fa fa-user" data-toggle="modal" data-target="#myModal">                                                
                                    </i>
                                </div>
                            </div>
                            <div class="form-bottom">
                                <form role="form" action="" method="post" class="login-form">
                                    <div class="form-group">
                                        <label class="sr-only" for="form-username">Username</label>
                                        <input type="text" name="form-username" placeholder="Username..." class="required form-username form-control" data-valid="isNonEmpty" data-error="用户名不能为空" id="form-username">
                                    </div>
                                    <div class="form-group">
                                        <label class="sr-only" for="form-password">Password</label>
                                        <input type="password" name="form-password" placeholder="Password..."  class="required form-password form-control" data-valid="isNonEmpty" data-error="密码不能为空" id="form-password">
                                    </div>
                                    <div class="form-group">
                                        <label class="sr-only" for="form-password">Password</label>
                                        <input type="password" name="form-password" placeholder="InputPasswordAgain..."  class="required form-password form-control" data-valid="isNonEmpty" data-error="密码不能为空" id="form-password2">
                                    </div>
                                    <div class="form-group">
                                        <label class="sr-only" for="form-Email">Email</label>
                                        <input type="text" name="form-Email" placeholder="Email..." class="required form-Email form-control" data-valid="isEmail" data-error="请输入正确的email格式" id="form-Email">
                                    </div>
                                    <div class="form-group">
                                        <label class="sr-only" for="form-Phone">Phone</label>
                                        <input type="text" name="form-Phone" placeholder="Phone..." class="required form-Phone form-control" data-valid="isPhone" data-error="请输入正确的phone格式" id="form-Phone">
                                    </div>
                                    <div class="form-group">
                                        <label >Sex</label>
                                        <input type="radio" name="radio" id="r4" value=0 checked="">
                                        <label for="r4"><span></span>男</label>
                                        <input type="radio" name="radio" id="r5" value=1 >
                                        <label for="r5" class="font-weight-400"><span></span>女</label>
                                    </div>
                                    <div class="form-group">
                                        <label class="sr-only" for="form-UserAddress">UserAddress</label>
                                        <input type="text" name="form-UserAddress" placeholder="UserAddress..." class="required form-UserAddress form-control" id="form-UserAddress">
                                    </div>
                                    <div class="form-group">
                                        <label class="sr-only" for="form-UserIntro">UserIntro</label>
                                        <input type="text" name="form-UserIntro" placeholder="UserIntro..." class="required form-UserIntro form-control"id="form-UserIntro">
                                    </div>
                                    <button type="button" class="btn" id="register" onclick="onRegister()">Sign in!</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



        </div>

        <!--模态框上传头像-->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="tailoring-container">
                        <div class="black-cloth" onclick="closeTailor(this)"></div>
                        <div class="tailoring-content">
                            <div class="tailoring-content-one">
                                <label title="上传图片" for="chooseImg" class="l-btn choose-btn">
                                    <input type="file" accept="image/jpg,image/jpeg,image/png" name="file" id="chooseImg" class="hidden" onchange="selectImg(this)">
                                    选择图片
                                </label>
                                <div class="close-tailoring"  onclick="closeTailor(this)">×</div>
                            </div>
                            <div class="tailoring-content-two">
                                <div class="tailoring-box-parcel">
                                    <img id="tailoringImg">
                                </div>
                                <div class="preview-box-parcel">
                                    <p>图片预览：</p>
                                    <div class="square previewImg"></div>
                                    <div class="circular previewImg"></div>
                                </div>
                            </div>
                            <div class="tailoring-content-three">
                                <button class="l-btn cropper-reset-btn">复位</button>
                                <button class="l-btn cropper-rotate-btn">旋转</button>
                                <button class="l-btn cropper-scaleX-btn">换向</button>
                                <button class="l-btn sureCut" id="sureCut" onclick = "upload">确定</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- /.modal -->
        </div>        

    </body>
</html>
